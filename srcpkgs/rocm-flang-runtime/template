# Template file for 'rocm-flang-runtime'
pkgname=rocm-flang-runtime
version=6.1.0
revision=1
archs="x86_64"
build_style=cmake
# todo
configure_args="-Wno-dev -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/opt/rocm/lib/llvm -DLLVM_ENABLE_ASSERTIONS=ON -DLLVM_CONFIG=/opt/rocm/lib/llvm/bin/llvm-config -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_CXX_COMPILER=/opt/rocm/lib/llvm/bin/clang++ -DCMAKE_C_COMPILER=/opt/rocm/lib/llvm/bin/clang -DCMAKE_Fortran_COMPILER=/opt/rocm/lib/llvm/bin/flang -DLLVM_TARGETS_TO_BUILD='AMDGPU;X86' -DLLVM_INSTALL_RUNTIME=ON -DFLANG_BUILD_RUNTIME=ON -DFLANG_INCLUDE_TESTS=OFF -DCMAKE_C_FLAGS=-I/builddir/${pkgname}-${version}/runtime/libpgmath/lib/common -DCMAKE_CXX_FLAGS=-I/builddir/${pkgname}-${version}/runtime/libpgmath/lib/common -DOPENMP_BUILD_DIR=/opt/rocm/lib/llvm/lib -DLIBPGMATH=/opt/rocm/lib/llvm/lib/libpgmath.so"
make_cmd=make
hostmakedepends="rocm-llvm rocm-flang rocm-llvm-openmp python3"
makedepends="rocm-flang-pgmath zlib-devel"
depends="rocm-flang rocm-flang-pgmath rocm-llvm-openmp libgcc libquadmath"
short_desc="ROCm flang Fortran compiler runtime libraries"
maintainer="Erick Vilcica <erick.vilcica@protonmail.com>"
license="Apache-2.0 WITH LLVM-exception"
homepage="https://github.com/ROCm-Developer-Tools/flang"
distfiles="https://github.com/ROCm-Developer-Tools/flang/archive/rocm-${version}.tar.gz"
checksum=51ecd2c154568c971f5b46ff0e1e1b57063afe28d128fc88c503de88f7240267
noverifyrdeps=yes
LDFLAGS=-L/opt/rocm/lib
export CMAKE_GENERATOR="Unix Makefiles"

post_install() {
	# this exact file is already installed by rocm-flang
	rm ${PKGDESTDIR}/opt/rocm/lib/llvm/include/omp_lib.h
}
