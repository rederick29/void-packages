# Template file for 'magma'
pkgname=magma
version=2.8.0
revision=1
build_style=cmake
configure_args="-DCMAKE_C_COMPILER=/opt/rocm/bin/hipcc -DCMAKE_CXX_COMPILER=/opt/rocm/bin/hipcc -DCMAKE_Fortran_COMPILER=/opt/rocm/lib/llvm/bin/flang -DCMAKE_BUILD_TYPE=Release -DCMAKE_MODULE_PATH=/opt/rocm -DCMAKE_PREFIX_PATH=/opt/rocm -DCMAKE_INSTALL_PREFIX=/opt/rocm -DBUILD_SHARED_LIBS=ON -DMAGMA_ENABLE_HIP=ON -DMAGMA_HAVE_HIP=1 -DGPU_TARGET=$(vopt_if gfx803 'gfx803;')$(vopt_if gfx900 'gfx900;')$(vopt_if gfx906 'gfx906;')$(vopt_if gfx908 'gfx908;')$(vopt_if gfx90a 'gfx90a;')$(vopt_if gfx940 'gfx940;')$(vopt_if gfx941 'gfx941;')$(vopt_if gfx942 'gfx942;')$(vopt_if gfx1010 'gfx1010;')$(vopt_if gfx1011 'gfx1011;')$(vopt_if gfx1012 'gfx1012;')$(vopt_if gfx1030 'gfx1030;')$(vopt_if gfx1031 'gfx1031;')$(vopt_if gfx1100 'gfx1100;')$(vopt_if gfx1101 'gfx1101;')$(vopt_if gfx1102 'gfx1102;')"
# flang instead of gcc-fortran
hostmakedepends="rocm-flang-runtime hipamd"
makedepends="hipBLAS hipSPARSE rocm-llvm-openmp lapack-devel"
short_desc="Matrix Algebra on GPU and Multi-core Architectures (HIP backend)"
maintainer="Erick Vilcica <erick.vilcica@protonmail.com>"
license="custom:magma"
homepage="https://icl.utk.edu/magma/"
distfiles="https://icl.utk.edu/projectsfiles/magma/downloads/magma-${version}.tar.gz"
checksum=f4e5e75350743fe57f49b615247da2cc875e5193cc90c11b43554a7c82cc4348
LDFLAGS="-L/opt/rocm/lib -L/opt/rocm/llvm/lib"

build_options="gfx803 gfx900 gfx906 gfx908 gfx90a gfx940 gfx941 gfx942 gfx1010 gfx1011 gfx1012 gfx1030 gfx1031 gfx1100 gfx1101 gfx1102"

build_options_default="gfx803 gfx900 gfx906 gfx908 gfx90a gfx940 gfx941 gfx942 gfx1010 gfx1011 gfx1012 gfx1030 gfx1031 gfx1100 gfx1101 gfx1102"

post_install() {
	vlicense COPYRIGHT
}
